# P5Canvas – Product Requirements Document（PRD）

## 1. プロダクト概要

### プロダクト名

**P5Canvas**

### 目的

P5Canvas は、**自然言語（プロンプト）を入力するだけで、p5.js を使った簡単な 2D ゲームを即座に生成・実行できる Web アプリケーション**です。

本プロダクトは、**小学生低〜中学年向けのワークショップ**での利用を主目的とし、以下の体験を提供します。

- ユーザーはコードを書かない
- ユーザーは AI に「作りたいゲームの内容」を伝えるだけ
- 生成されたゲームは、その場でブラウザ上で即プレイできる
- 作品の保存・共有は不要（その場体験に特化）

---

## 2. 想定ユーザー

### エンドユーザー

- 小学生低学年〜中学年
- タブレット／PC 混在環境
- キーボード操作ができないユーザーも含む

### 運用ユーザー

- ユーザー認証は不要
- ワークショップ主催者・講師
- API キー・サーバー管理は主催者側で行う

---

## 3. スコープ（やること／やらないこと）

### やること（In Scope）

- プロンプト入力 UI の提供
- バックエンドでの LLM API 呼び出し
- **p5.js に特化したゲーム生成**
- 生成結果を **Sandpack を用いて即時実行**
- タッチ操作対応の 2D ゲーム実行
- 再生成・リセットが高速かつ安定して行えること

### やらないこと（Out of Scope）

- ユーザーによるコード編集機能
- プロジェクト保存・アカウント管理
- ゲームの URL 共有・ダウンロード
- 高度な 3D ゲーム、物理エンジン、ネットワーク通信
- Web アプリ（React 等）の生成

---

## 4. 対象ゲーム仕様

### 対象ジャンル（初期）

以下のような **シンプルな 2D ゲーム** に限定する。

- ブロック崩し
- インベーダー風シューティング
- 横スクロール／ランナー（マリオ“風”だが軽量）

### 共通制約

- 1 canvas
- 1 ファイル構成（p5.js）
- タッチ操作前提（仮想ボタン／タップ）
- FPS・処理負荷は低く保つこと

---

## 5. 全体アーキテクチャ

```
[フロントエンド]
  - プロンプト入力UI
  - Sandpack（p5.js実行）
        ↓
[バックエンド]
  - プロンプト正規化
  - LLM API 呼び出し
  - ゲーム設定（config）生成
        ↓
[フロントエンド]
  - config.json を Sandpack に反映
  - 即時再実行
```

### 重要な設計方針

- **LLM は「コード全体」を生成しない**
- LLM は **ゲーム設定（config JSON）のみを生成**
- 実行ロジックはフロント側の固定テンプレに集約

---

## 6. LLM 利用方針

### LLM の役割

- ユーザーの自然言語プロンプトを解釈
- p5.js ゲーム用の **構造化された設定データ（JSON）** を生成

### LLM に生成させないもの

- JavaScript コード全体
- DOM 操作
- 外部通信（fetch 等）
- 無限ループを含むロジック

### 生成物の形式（例）

```json
{
  "gameType": "breakout",
  "ballSpeed": 5,
  "paddleWidth": 120,
  "blockRows": 5,
  "enemyColor": "red",
  "difficulty": "easy"
}
```

※ 実際のスキーマは固定し、バリデーションを必須とすること。

---

## 7. Sandpack 利用設計（重要）

### Sandpack の役割

- ブラウザ内で **隔離された p5.js 実行環境** を提供
- iframe 内で canvas を描画
- 外部への副作用を防止

### Sandpack に渡す files 構成（基本）

- `/index.html`

  - p5.js を CDN から読み込む
  - canvas の mount 先を用意

- `/index.js`（固定・テンプレ）

  - p5 インスタンス管理
  - config.json 読み込み
  - ゲームロジック実装
  - タッチ UI・リセット処理

- `/config.json`（LLM 生成）

  - Sandpack 更新時に差し替え

### 再実行時の要件

- 既存 p5 インスタンスは必ず `remove()` してから再生成
- Sandpack コンポーネント自体は再マウントしない
- files の差分更新のみで再実行すること

---

## 8. フロントエンド要件

### UI 要件

- プロンプト入力は **短文前提**
- 子どもが迷わない UI（1 画面完結）
- 送信中・生成中はローディング表示
- エラー時は「必ず遊べるフォールバックゲーム」を表示

### 操作要件

- タッチ操作対応（仮想ボタン）
- キーボード操作はオプション

---

## 9. バックエンド要件

### API 設計

- `/api/generate-config`

  - Input: 正規化済みプロンプト
  - Output: config JSON

### ガードレール

- トークン数制限
- レート制限
- 危険語・個人情報の除外
- JSON スキーマバリデーション

### ログ・データ保持

- プロンプト・生成物は原則保存しない
- 必要な場合も匿名・短期保持

---

## 10. 非機能要件

### パフォーマンス

- 生成後、**5 秒以内にプレイ可能**
- タブレット（iPad クラス）で安定動作

### 安定性

- 生成失敗時でも UI が壊れない
- 再生成を何度行っても状態が破綻しない

### セキュリティ

- API キーはクライアントに露出しない
- Sandpack iframe 以外で任意コードを実行しない

---

## 11. 初期 MVP の完成条件

以下が満たされれば MVP 完成とする。

- プロンプト入力 → 生成 → 即プレイの一連の流れが動く
- ブロック崩し系ゲームが 1 種類安定して生成できる
- タブレットで操作可能
- 30 人規模のワークショップで同時利用可能

---

## 12. 将来拡張（参考・非必須）

- ゲームタイプ追加
- config プリセット選択 UI
- 難易度スライダー
- 教育向けワークショップモード

---

### 補足（コーディング AI への指示）

- **自由度より安定性を優先すること**
- 「壊れない体験」が最重要 KPI
- Claude Artifacts / openartifacts / LlamaCoder の思想は参考にしてよいが、**Web アプリ生成機能は持ち込まないこと**

---

以上が **P5Canvas** の PRD です。
このドキュメントをそのまま **コーディング AI（実装エージェント）への入力**として使える粒度にしています。
